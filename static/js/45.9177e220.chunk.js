"use strict";(self.webpackChunkweb_workshop=self.webpackChunkweb_workshop||[]).push([[45],{27045:(e,r,t)=>{t.r(r),t.d(r,{default:()=>w});var i=t(65043),n=t(73216),s=t(87021),o=t(22019),l=t(85578),a=t(48807),d=t(7661),c=t(59748),h=t(53722),x=t(36160),p=t(22706),m=t(75337),u=t(43428),y=t(68088),g=t(70579);const j=e=>{let{user:r}=e;const t=(0,n.Zp)();return(0,g.jsxs)(y.Zh,{style:{width:"276px",height:"48px",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,g.jsx)(y.EY,{size:"title",children:(0,g.jsx)(h.A,{})}),(0,g.jsx)(y.EY,{size:"title",style:{height:"42px",lineHeight:1,marginLeft:"12px",overflow:"hidden"},children:r?r.username:"\u672a\u767b\u5f55"}),(0,g.jsx)(s.Ay,{style:{width:"36px",height:"36px",fontSize:"36px",marginLeft:"12px"},onClick:()=>{r?(localStorage.removeItem("token"),t(0)):t("/login")},type:"link",danger:!!r,children:r?(0,g.jsx)(x.A,{}):(0,g.jsx)(p.A,{})})]})},f=e=>{let{user:r,rooms:t,refetchRooms:n}=e;const[a,d]=(0,i.useState)(""),[c,h]=(0,i.useState)(!1),{refetch:x}=u.SV({skip:6!==a.length}),[p]=u.k$();return(0,g.jsxs)(y.Zh,{style:{width:"276px",height:"48px",display:"flex",alignItems:"center"},children:[(0,g.jsx)(l.A,{variant:"filled",style:{width:"150px",height:"40px",fontSize:"24px",fontFamily:"monospace",marginLeft:"6px"},placeholder:"\u8f93\u5165\u9080\u8bf7\u7801",maxLength:6,value:a,onChange:e=>{const r=e.target.value;d(r.replace(/[^a-zA-Z0-9]/g,""))}}),(0,g.jsx)(s.Ay,{type:"primary",style:{height:"40px",fontSize:"18px",marginLeft:"12px",marginRight:"4px"},onClick:async()=>{var e,i;if(h(!0),6!==a.length)return o.Ay.error("\u9080\u8bf7\u7801\u957f\u5ea6\u9519\u8bef\uff01"),h(!1);if(null!==t&&void 0!==t&&t.find((e=>e.room.invite_code===a)))return o.Ay.error("\u5df2\u52a0\u5165\u8be5\u623f\u95f4\uff01"),h(!1);const s=await x({invite_code:a});if(s.errors)return console.error(s.errors),o.Ay.error("\u83b7\u53d6\u623f\u95f4\u5931\u8d25\uff01"),h(!1);if(0===(null===(e=s.data)||void 0===e?void 0:e.room.length))return o.Ay.error("\u623f\u95f4\u4e0d\u5b58\u5728\uff01"),h(!1);const l=null===(i=s.data)||void 0===i?void 0:i.room[0],c=await p({variables:{room_uuid:null===l||void 0===l?void 0:l.uuid,user_uuid:r.uuid}});c.errors?(console.error(c.errors),o.Ay.error("\u52a0\u5165\u623f\u95f4\u5931\u8d25\uff01")):(o.Ay.success("\u52a0\u5165\u623f\u95f4\u6210\u529f\uff01"),n()),d(""),h(!1)},loading:c,children:(0,g.jsx)("strong",{children:"\u52a0\u5165\u4f1a\u8bae"})})]})},v=e=>{let{user:r,rooms:t,refetchRooms:n,addChatBox:h,addFileShare:x}=e;const[p,j]=(0,i.useState)(!1),[f,v]=(0,i.useState)(!1),[w]=u.JV(),[k]=u.k$(),S=async e=>{v(!0);const t=await w({variables:{name:e.name,intro:e.intro,invite_code:Math.random().toString(36).slice(2,8).toUpperCase()}});if(t.errors)console.error(t.errors),o.Ay.error("\u521b\u5efa\u623f\u95f4\u5931\u8d25\uff01");else{var i,s;const e=await k({variables:{room_uuid:null===(i=t.data)||void 0===i||null===(s=i.insert_room_one)||void 0===s?void 0:s.uuid,user_uuid:r.uuid}});e.errors?(console.error(e.errors),o.Ay.error("\u52a0\u5165\u623f\u95f4\u5931\u8d25\uff01")):o.Ay.success("\u521b\u5efa\u5e76\u52a0\u5165\u623f\u95f4\u6210\u529f\uff01")}v(!1),j(!1),n()};return(0,g.jsxs)(y.Zh,{style:{width:"276px",height:"300px",display:"flex",flexDirection:"column"},children:[(0,g.jsx)(s.Ay,{type:"primary",style:{height:"40px",fontSize:"18px",margin:"4px 4px 12px 6px"},icon:(0,g.jsx)(m.A,{}),onClick:()=>j(!0),children:(0,g.jsx)("strong",{children:"\u521b\u5efa\u65b0\u7684\u4f1a\u8bae"})}),(0,g.jsx)(y.OY,{children:(0,g.jsx)(a.A,{size:"small",itemLayout:"vertical",dataSource:t,renderItem:(e,r)=>(0,g.jsx)(A,{room:e.room,handleOpenChat:()=>h(r),handleOpenFileShare:()=>x(r)})})}),(0,g.jsxs)(d.A,{title:"\u521b\u5efa\u65b0\u7684\u4f1a\u8bae",open:p,okText:"\u521b\u5efa",okButtonProps:{autoFocus:!0,htmlType:"submit"},confirmLoading:f,onCancel:()=>j(!1),cancelText:"\u53d6\u6d88",destroyOnClose:!0,modalRender:e=>(0,g.jsx)(c.A,{onFinish:S,clearOnDestroy:!0,children:e}),children:[(0,g.jsx)(c.A.Item,{style:{marginTop:"24px"},label:"\u4f1a\u8bae\u540d\u79f0",name:"name",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u4f1a\u8bae\u540d\u79f0\uff01"}],children:(0,g.jsx)(l.A,{placeholder:"\u8f93\u5165\u4f1a\u8bae\u540d\u79f0"})}),(0,g.jsx)(c.A.Item,{label:"\u4f1a\u8bae\u7b80\u4ecb",name:"intro",children:(0,g.jsx)(l.A,{placeholder:"\u8f93\u5165\u4f1a\u8bae\u7b80\u4ecb"})})]})]})},A=e=>{let{room:r,handleOpenChat:t,handleOpenFileShare:i}=e;const n=new Date(r.created_at),s=new Date(n.getTime()-6e4*n.getTimezoneOffset());return(0,g.jsx)(a.A.Item,{style:{padding:"8px"},children:(0,g.jsxs)("div",{children:[(0,g.jsx)(y.EY,{children:(0,g.jsx)("strong",{children:r.name})}),(0,g.jsx)("br",{}),(0,g.jsx)(y.EY,{size:"small",editable:!0,children:r.intro}),(0,g.jsx)("br",{}),(0,g.jsxs)(y.EY,{size:"small",children:["\u521b\u5efa\u4e8e"," ",s.toLocaleString("zh-CN",{dateStyle:"short",timeStyle:"short"})]}),(0,g.jsxs)(y.EY,{size:"small",style:{marginLeft:"12px"},copyable:{text:r.invite_code},children:["\u9080\u8bf7\u7801 ",r.invite_code]}),(0,g.jsx)("br",{}),(0,g.jsx)(y.N_,{style:{marginTop:"6px"},onClick:t,children:"\u6253\u5f00\u804a\u5929\u5ba4"}),(0,g.jsx)(y.N_,{style:{marginLeft:"12px"},onClick:i,children:"\u6253\u5f00\u6587\u4ef6\u5171\u4eab\u7a7a\u95f4"}),(0,g.jsx)(y.N_,{danger:!0,style:{marginLeft:"12px"},onClick:()=>{o.Ay.info("\u6682\u672a\u5b9e\u73b0")},children:"\u9000\u51fa\u4f1a\u8bae"})]})})},w=e=>(0,g.jsxs)(y.Zp,{style:{width:"300px",height:"fit-content",zIndex:100},children:[(0,g.jsx)(j,{...e}),e.rooms&&(0,g.jsx)(f,{...e}),e.rooms&&(0,g.jsx)(v,{...e})]})}}]);
//# sourceMappingURL=45.9177e220.chunk.js.map